<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí¨ Nova Avalia√ß√£o - Campus UEL</title>

    <link rel="icon"
          href="data:image/svg+xml;charset=utf-8,
          <svg xmlns='http://www.w3.org/2000/svg' width='17' height='18'>
              <text y='15' font-size='14'>üíö</text>
          </svg>">
    <link rel="stylesheet" th:href="@{/geral/style.css}">

    <script>
        function adicionarQuestao() {
            const container = document.getElementById('novas-questoes');
            const index = container.children.length;

            const bloco = document.createElement('div');
            bloco.classList.add('nova-questao');
            bloco.innerHTML = `
                <hr style="margin: 1rem 0;">
                <label>üÜï Nova Quest√£o ${index + 1}</label>
                <input type="text" name="novasQuestoes[${index}].texto" placeholder="Texto da nova quest√£o" required>

                <label>Tipo:</label>
                <select name="novasQuestoes[${index}].tipo" onchange="toggleOpcoes(this, ${index})">
                    <option value="padrao">Dissertativa</option>
                    <option value="multipla">M√∫ltipla escolha</option>
                </select>

                <div id="opcoes-${index}" style="display:none; margin-top:0.5rem;">
                    <label>Op√ß√µes (se m√∫ltipla escolha)</label>
                    <small>Separe as op√ß√µes por v√≠rgula (,)</small>
                    <input type="text" name="novasQuestoes[${index}].opcoes" placeholder="Ex: Ruim,Razo√°vel,Bom,Excelente">
                </div>
            `;
            container.appendChild(bloco);
        }

        function toggleOpcoes(select, index) {
            const div = document.getElementById(`opcoes-${index}`);
            div.style.display = select.value === 'multipla' ? 'block' : 'none';
        }
    </script>
</head>

<body>
<nav>
    <div class="logo"><h1>Campus UEL</h1></div>
    <ul class="nav-links">
        <li><a th:href="@{/}">Tela inicial</a></li>
        <li><a th:href="@{/usuarios}">Usu√°rios</a></li>
        <li><a th:href="@{/locais}">Locais</a></li>
        <li><a th:href="@{/questoes}">Quest√µes</a></li>
    </ul>
</nav>

<section class="avaliacao-form">
    <h2>üí¨ Nova Avalia√ß√£o</h2>
    <p>Preencha os campos abaixo para registrar sua avalia√ß√£o de um local do campus.</p>

    <form th:action="@{/avaliacoes/registrar}" th:object="${avaliacaoRequest}" method="post">

        <h3>üë§ Informa√ß√µes do Avaliador</h3>

        <label for="nome">Nome:</label>
        <input id="nome" type="text" th:field="*{nome}" required>

        <label for="email">E-mail:</label>
        <input id="email" type="email" th:field="*{email}" required>

        <label for="tipo">Tipo:</label>
        <select id="tipo" th:field="*{tipo}" required>
            <option value="">Selecione...</option>
            <option value="aluno">Aluno</option>
            <option value="professor">Professor</option>
        </select>

        <label for="cursoNome">Curso (se aluno):</label>
        <input id="cursoNome" type="text" th:field="*{cursoNome}">

        <label for="departamento">Departamento:</label>
        <input id="departamento" type="text" th:field="*{departamento}">

        <h3>üìç Local Avaliado</h3>
        <select id="local" th:field="*{idLocal}" required>
            <option value="">Selecione o local...</option>
            <option th:each="local : ${locais}"
                    th:value="${local.idLocal}"
                    th:text="${local.nome}"></option>
        </select>

        <h3>üß© Quest√µes Abertas</h3>
        <div th:each="questao : ${questoesPadrao}">
            <label th:text="${questao.texto}"></label>

            <div th:if="${questao.tipo == 'multipla'}">
                <select th:name="${'respostas[' + questao.idQuestao + ']'}">
                    <option value="">Selecione...</option>
                    <option th:each="opt : ${(questao.opcoes != null) ? questao.opcoes.split(',') : #lists.create()}"
                            th:value="${opt.trim()}"
                            th:text="${opt.trim()}"></option>
                </select>
            </div>

            <div th:if="${questao.tipo != 'multipla'}">
                <input type="text"
                       th:name="${'respostas[' + questao.idQuestao + ']'}"
                       placeholder="Sua resposta">
            </div>
        </div>

        <h3>üí° Quest√µes de M√∫ltipla Escolha</h3>
        <div th:each="questao : ${questoesPersonalizadas}">
            <label th:text="${questao.texto}"></label>

            <div th:if="${questao.tipo == 'multipla'}">
                <select th:name="${'respostas[' + questao.idQuestao + ']'}">
                    <option value="">Selecione...</option>
                    <option th:each="opt : ${(questao.opcoes != null) ? questao.opcoes.split(',') : #lists.create()}"
                            th:value="${opt.trim()}"
                            th:text="${opt.trim()}"></option>
                </select>
            </div>

            <div th:if="${questao.tipo != 'multipla'}">
                <input type="text"
                       th:name="${'respostas[' + questao.idQuestao + ']'}"
                       placeholder="Sua resposta">
            </div>
        </div>

<!--        <h3>üÜï Adicionar novas quest√µes</h3>-->
<!--        <div id="novas-questoes"></div>-->

<!--        <button type="button" class="btn" onclick="adicionarQuestao()">+ Nova Quest√£o</button>-->

        <div style="margin-top: 2rem; display: flex; justify-content: space-between;">
            <a href="/" class="btn">Cancelar</a>
            <button type="submit" class="btn">Salvar Avalia√ß√£o</button>
        </div>
    </form>
</section>

<footer>
    <p>&copy; 2025 UEL - Todos os direitos reservados.</p>
</footer>

</body>
</html>
