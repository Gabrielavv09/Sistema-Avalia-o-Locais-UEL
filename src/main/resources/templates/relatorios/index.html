<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Relat√≥rios - Campus UEL</title>
    <link rel="stylesheet" th:href="@{/geral/style.css}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav>
    <div class="logo"><h1>Campus UEL</h1></div>
    <ul class="nav-links">
        <li><a th:href="@{/}">Tela inicial</a></li>
        <li><a th:href="@{/relatorios}">Relat√≥rios</a></li>
        <li><a th:href="@{/usuarios}">Usu√°rios</a></li>
        <li><a th:href="@{/locais}">Locais</a></li>
    </ul>
</nav>

<section class="hero" style="padding: 40px 20px;">
    <h2>Painel de Relat√≥rios üìà</h2>
    <p>Visualize as estat√≠sticas e o desempenho dos locais do campus.</p>
</section>

<div style="max-width: 900px; margin: 0 auto; padding: 20px;">

    <div style="margin-bottom: 60px;">
        <h3 style="border-bottom: 2px solid #28a745; padding-bottom: 10px; color: #333;">1. M√©dia de Avalia√ß√µes por Local (Ranking)</h3>
        <p>Nota m√©dia geral (0 a 5) atribu√≠da pelos usu√°rios.</p>

        <div style="margin-bottom: 20px;">
            <h4>üèÜ Top 3 Lugares</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                <thead>
                <tr style="background-color: #f2f2f2;">
                    <th style="padding: 8px; border: 1px solid #ddd;">Posi√ß√£o</th>
                    <th style="padding: 8px; border: 1px solid #ddd;">Local</th>
                    <th style="padding: 8px; border: 1px solid #ddd;">Nota M√©dia</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item, stat : ${mediasLocais}" th:if="${stat.index < 3}">
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;" th:text="${stat.count} + '¬∫'">1¬∫</td>
                    <td style="padding: 8px; border: 1px solid #ddd;" th:text="${item.local}">Local</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: bold; color: #28a745;" th:text="${item.media}">5.0</td>
                </tr>
                </tbody>
            </table>
        </div>

        <h3 style="border-bottom: 2px solid #28a745; padding-bottom: 10px; color: #333;">2. Top 6 maiores m√©dias do locais avaliados</h3>
        <p>Gr√°fico de barras com a nota m√©dia.</p>
        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
            <canvas id="graficoLocais"></canvas>
        </div>
    </div>

    <div style="margin-bottom: 60px;">
        <h3 style="border-bottom: 2px solid #e67e22; padding-bottom: 10px; color: #333;">3. Comparativo: Alunos vs Professores</h3>
        <p>M√©dia das notas dadas por cada categoria de usu√°rio.</p>

        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto;">
            <canvas id="graficoUsuarios"></canvas>
        </div>
    </div>

    <div style="margin-bottom: 60px;">
        <h3 style="border-bottom: 2px solid #6c757d; padding-bottom: 10px; color: #333;">
            4. Evolu√ß√£o das avalia√ß√µes ao longo do tempo
        </h3>
        <p>Varia√ß√£o da nota m√©dia ao longo do tempo.</p>
        <div style="background: white; padding: 20px; border-radius: 10px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto;">
            <canvas id="graficoEvolucao"></canvas>
        </div>
    </div>


</div>

<footer><p>&copy; 2025 UEL - Todos os direitos reservados.</p></footer>

<script th:inline="javascript">
    var dadosLocais = [[${mediasLocais}]];
    var dadosUsuarios = [[${mediasUsuarios}]];
    var dadosEvolucao = [[${evolucaoAvaliacoes}]];

    // 02
    var labelsLocais = dadosLocais.map(d => d.local);
    var valoresLocais = dadosLocais.map(d => d.media);

    var ctxLocais = document.getElementById('graficoLocais');
    if (ctxLocais) {
        new Chart(ctxLocais, {
            type: 'bar',
            data: {
                labels: labelsLocais,
                datasets: [{
                    label: 'Nota M√©dia',
                    data: valoresLocais,
                    backgroundColor: 'rgba(40, 167, 69, 0.6)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, max: 5 } }
            }
        });
    }

    // 03
    var labelsTipo = dadosUsuarios.map(d => d.tipo);
    var valoresTipo = dadosUsuarios.map(d => d.media);

    var ctxUsuarios = document.getElementById('graficoUsuarios');
    if (ctxUsuarios) {
        new Chart(ctxUsuarios, {
            type: 'pie', // ou 'pie'
            data: {
                labels: labelsTipo,
                datasets: [{
                    label: 'Nota M√©dia por Categoria',
                    data: valoresTipo,
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, max: 5 } }
            }
        });
    }

    // 04
    var labelsEvolucao = dadosEvolucao.map(d => d.semana);
    var valoresEvolucao = dadosEvolucao.map(d => d.media);

    var ctxEvolucao = document.getElementById('graficoEvolucao');
    if (ctxEvolucao) {
        new Chart(ctxEvolucao, {
            type: 'line',
            data: {
                labels: labelsEvolucao,
                datasets: [{
                    label: 'Nota m√©dia semanal',
                    data: valoresEvolucao,
                    fill: false,
                    tension: 0.3,
                    borderColor: 'rgba(108, 117, 125, 1)',
                    backgroundColor: 'rgba(108, 117, 125, 0.3)',
                    pointRadius: 4,
                    pointHoverRadius: 6
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true, max: 5 }
                }
            }
        });
    }
</script>

</body>
</html>